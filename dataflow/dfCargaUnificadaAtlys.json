{
	"name": "dfCargaUnificadaAtlys",
	"properties": {
		"folder": {
			"name": "Atlys"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "CVTB_ATLYS_ADJ",
						"type": "DatasetReference"
					},
					"name": "TabelaADJ"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "CVTB_CONTESTACAO",
						"type": "DatasetReference"
					},
					"name": "TabelaCONTESTACAO"
				}
			],
			"transformations": [
				{
					"name": "derivedColumn1"
				}
			],
			"script": "parameters{\n\tpLote as string\n}\nsource(output(\n\t\tID_LOTE as decimal(28,0),\n\t\tID_ATLYS_ADJ as decimal(28,0),\n\t\tID_LOTE_ARQUIVO as decimal(28,0),\n\t\tID_CLIENTE as string,\n\t\tNOTA_FISCAL as string,\n\t\tDT_EMISSAO_NF as timestamp,\n\t\tVLR_ORIG_NFST as decimal(10,2),\n\t\tSERIE as string,\n\t\tCONTA_CLIENTE as string,\n\t\tCNPJ_CPF as string,\n\t\tNOM_CLIENTE as string,\n\t\tNUM_TERMINAL as string,\n\t\tVLR_CONTEST_AJUSTE as decimal(10,2),\n\t\tVLR_ATRIBUIDO as decimal(10,2),\n\t\tDT_ATRIBUICAO as timestamp,\n\t\tHR_ATRIBUICAO as string,\n\t\tDT_AJUSTE as timestamp,\n\t\tHR_AJUSTE as string,\n\t\tOPERADORA as string,\n\t\tCODIGO_OPERADORA as string,\n\t\tCOD_MOTIVO_AJUSTES as string,\n\t\tDESC_MOTIVO_AJUSTE as string,\n\t\tDATA_ABERTURA_IMPU as timestamp,\n\t\tDATA_FECH_IMPUG as timestamp,\n\t\tDSPUT_ID as string,\n\t\tTP_NOTA_FISCAL as string,\n\t\tCLASSE_RECEBER as string,\n\t\tCONTA_CONTABIL as string,\n\t\tDESCR_CONTA_CONTABIL as string,\n\t\tNUMERO_FATURA as string,\n\t\tVALOR_DOCTO_ORIGINAL as decimal(15,2),\n\t\tMES_ANO_REFERENTE as string,\n\t\tDATA_VENC_FATUR as timestamp,\n\t\tVALOR_PAGAMENTO as decimal(15,2),\n\t\tDATA_ATRIBUICAO_PGTO as timestamp,\n\t\tFATU_ATRIBUIDA as string,\n\t\tDT_EMISSAO_FATURA as timestamp,\n\t\tMES_ANO_FATURA as string,\n\t\tVALOR_FATURA as decimal(15,2),\n\t\tSALDO_DEVEDOR as decimal(15,2),\n\t\tUF as string,\n\t\tOPERADORA_REAL as string,\n\t\tSALDO_FATURA_INI as decimal(15,2),\n\t\tSALDO_FATURA_FIM as decimal(15,2),\n\t\tSEQ_RECEBIVEL as string\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: (\"SELECT l.ID_LOTE, adj.ID_ATLYS_ADJ ,adj.ID_LOTE_ARQUIVO ,adj.ID_CLIENTE ,adj.NOTA_FISCAL ,adj.DT_EMISSAO_NF ,adj.VLR_ORIG_NFST ,adj.SERIE ,adj.CONTA_CLIENTE ,adj.CNPJ_CPF ,adj.NOM_CLIENTE ,adj.NUM_TERMINAL ,adj.VLR_CONTEST_AJUSTE ,adj.VLR_ATRIBUIDO ,adj.DT_ATRIBUICAO ,adj.HR_ATRIBUICAO ,adj.DT_AJUSTE ,adj.HR_AJUSTE ,adj.OPERADORA ,adj.CODIGO_OPERADORA ,adj.COD_MOTIVO_AJUSTES ,adj.DESC_MOTIVO_AJUSTE ,adj.DATA_ABERTURA_IMPU ,adj.DATA_FECH_IMPUG ,adj.DSPUT_ID,adj.TP_NOTA_FISCAL ,adj.CLASSE_RECEBER ,adj.CONTA_CONTABIL ,adj.DESCR_CONTA_CONTABIL ,adj.NUMERO_FATURA ,adj.VALOR_DOCTO_ORIGINAL ,adj.MES_ANO_REFERENTE ,adj.DATA_VENC_FATUR ,adj.VALOR_PAGAMENTO ,adj.DATA_ATRIBUICAO_PGTO ,adj.FATU_ATRIBUIDA ,adj.DT_EMISSAO_FATURA ,adj.MES_ANO_FATURA ,adj.VALOR_FATURA ,adj.SALDO_DEVEDOR ,adj.UF ,adj.OPERADORA_REAL ,adj.SALDO_FATURA_INI ,adj.SALDO_FATURA_FIM ,adj.SEQ_RECEBIVEL FROM CONVENIO.CVTB_ATLYS_ADJ adj, CONVENIO.CVTB_LOTE_ARQUIVO la, CONVENIO.CVTB_LOTE l where adj.ID_LOTE_ARQUIVO = la.ID_LOTE_ARQUIVO and la.ID_LOTE = l.ID_LOTE and l.ID_LOTE = convert(numeric(38), {$pLote})\"),\n\tformat: 'query') ~> TabelaADJ\nTabelaADJ derive(NUM_CONTROLE_RECLAMACAO_NORMALIZADO = iif(isNull(DSPUT_ID), concat(SERIE, '123'), DSPUT_ID),\n\t\tNOTA_FISCAL_ORIG_NORMALIZADO = NOTA_FISCAL,\n\t\tFL_STATUS_GERAL = 'NT',\n\t\tNOME_BILLING = 'Atlys',\n\t\tCD_CRIADO_POR = 'Carga ADF - CargaArqAtlys',\n\t\tDT_CRIADO_EM = add(currentTimestamp(), hours(-3))) ~> derivedColumn1\nderivedColumn1 sink(allowSchemaDrift: false,\n\tvalidateSchema: false,\n\tinput(\n\t\tID_CONTESTACAO as decimal(28,0),\n\t\tID_CLIENTE as string,\n\t\tNOTA_FISCAL_ORIG as string,\n\t\tDT_EMISSAO_NF_ORIG as timestamp,\n\t\tVLR_ORIG_NSFT as decimal(15,2),\n\t\tSERIE_NF as string,\n\t\tCOD_IDENT_CLI as string,\n\t\tCPF_CNPJ as string,\n\t\tNOME_CLIENTE as string,\n\t\tTERMINAL as string,\n\t\tVLR_TOTAL_ATRIBUIDO as decimal(15,2),\n\t\tVLR_ATRIBUIDO as decimal(15,2),\n\t\tDT_ATRIBUICAO as timestamp,\n\t\tDT_AJUSTE as timestamp,\n\t\tDESCR_OPERADORA as string,\n\t\tCOD_OPERADORA as string,\n\t\tCOD_MOTIVO_AJUSTE as string,\n\t\tDESC_MOTIVO_AJUSTE as string,\n\t\tNUM_CONTROLE_RECLAMACAO as string,\n\t\tCLASSE_RECEBER as string,\n\t\tCONTA_FINANCEIRA as string,\n\t\tDESC_CONTA_FINANCEIRA as string,\n\t\tNUM_FATURA_ORIGINAL as string,\n\t\tVLR_DOC_ORIGINAL as decimal(15,2),\n\t\tFATURA_ATRIBUIDA as string,\n\t\tVLR_FATURA as decimal(15,2),\n\t\tUF_FATURA as string,\n\t\tSEQ_RECEBIVEL as string,\n\t\tDT_EMISSAO as timestamp,\n\t\tMODELO as string,\n\t\tNUMORDEMDOITEM as decimal(3,0),\n\t\tBC_ICMS as decimal(15,2),\n\t\tICMS as decimal(15,2),\n\t\tALIQUOTA_ICMS as decimal(15,2),\n\t\tBC_ICMS_RECALCULADA as decimal(15,2),\n\t\tICMS_RECALCULADO as decimal(15,2),\n\t\tICMS_PARA_RESSARCIMENTO as decimal(15,2),\n\t\tSITUACAO as string,\n\t\tMES_APURACAO as string,\n\t\tTIPO_DOC as decimal(1,0),\n\t\tCOD_CONSUMIDOR as string,\n\t\tCHAVE_AUTENTICACAO as string,\n\t\tTOTAL_MESTRE as decimal(15,2),\n\t\tBC_ICMS_MESTRE as decimal(15,2),\n\t\tICMS_DESTACADO as decimal(15,2),\n\t\tINSCRICAO_ESTADUAL as string,\n\t\tRAZAO_SOCIAL as string,\n\t\tFL_STATUS_GERAL as string,\n\t\tID_LOTE_AJUSTE as decimal(28,0),\n\t\tID_ENTREGA_RESSARCIMENTO as decimal(28,0),\n\t\tCD_ITEM as string,\n\t\tDS_ITEM as string,\n\t\tHR_AJUSTE as string,\n\t\tHR_ATRIBUICAO as string,\n\t\tNOME_BILLING as string,\n\t\tTIPO_CLIENTE as string,\n\t\tDT_ABERTURA_IMPUG as timestamp,\n\t\tDT_FECHA_IMPUG as timestamp,\n\t\tSALDO_DEVEDOR as decimal(15,2),\n\t\tSALDO_FATURA_INI as decimal(15,2),\n\t\tSALDO_FATURA_FIM as decimal(15,2),\n\t\tCOD_CLIENTE as string,\n\t\tTIPO_DOCUMENTO as string,\n\t\tNOME_FANTASIA as string,\n\t\tCOD_GRUPO as string,\n\t\tNOME_GRUPO_ECONOMICO as string,\n\t\tSEGMENTO_CLIENTE as string,\n\t\tSUB_SEGMENTO_CLIENTE as string,\n\t\tSEGMENTO_VALOR as string,\n\t\tCLASSE_ELEGIBILIDADE as string,\n\t\tDESCR_SERV_AJUSTE as string,\n\t\tDESCR_SERV as string,\n\t\tCONTACONTABIL_DB as string,\n\t\tCONTACONTABIL_CR as string,\n\t\tDESCR_CONTACONTABIL_DB as string,\n\t\tDESCR_CONTACONTABIL_CR as string,\n\t\tSALDO_POS_AJUSTE as decimal(15,2),\n\t\tTIPO_OPERACAO as string,\n\t\tTIPO_TERMINAL as string,\n\t\tDONO_RECEITA as string,\n\t\tSUBTYPE_CODE as decimal(19,0),\n\t\tTIPO_DESCR_SERV as string,\n\t\tDT_VENCTO_FAT_FUTURA as timestamp,\n\t\tVLR_IMPOSTO_CONTESTADO as decimal(15,2),\n\t\tVLR_IMPOSTO_ICMS as decimal(15,2),\n\t\tVLR_BRUTO_ITEM as decimal(15,2),\n\t\tVLR_OUTROS_IMPOSTOS as decimal(15,2),\n\t\tVLR_AJUSTE_ITEM as decimal(15,2),\n\t\tVLR_CREDITO_AJUSTE as decimal(15,2),\n\t\tVLR_CREDITO_ITEM as decimal(15,2),\n\t\tVLR_DEVOLUCAO as decimal(15,2),\n\t\tVLR_FATURA_FUTURA as decimal(15,2),\n\t\tVLR_CONTESTADO_FUTURO as decimal(15,2),\n\t\tLOGIN_ATENDIMENTO as string,\n\t\tDT_VENC_FATURA_ORIGINAL as timestamp,\n\t\tDT_ATRIBUICAO_PGTO as timestamp,\n\t\tNUM_ITEM_ESTORNADO as decimal(10,0),\n\t\tFLG_RETIFICADO as string,\n\t\tTERMINAL_115 as string,\n\t\tVALOR_ITEM_115 as decimal(15,2),\n\t\tDT_CRIADO_EM as timestamp,\n\t\tCD_CRIADO_POR as string,\n\t\tDT_ATUALIZADO_EM as timestamp,\n\t\tCD_ATUALIZADO_POR as string,\n\t\tMES_ANO_FAT_ORIGINAL as string,\n\t\tMES_ANO_FAT_AJUSTE as string,\n\t\tVLR_PAGAMENTO_FAT_ORIGINAL as decimal(15,2),\n\t\tID_ITEM_CONVENIO_115 as decimal(28,0),\n\t\tNUM_CONTROLE_RECLAMACAO_NORMALIZADO as string,\n\t\tNOTA_FISCAL_ORIG_NORMALIZADO as string,\n\t\tCOD_FAC_CD as decimal(10,0),\n\t\tCCM_SERVICO_CONTESTADO as string,\n\t\tCOD_TIPO_RCBL_FATURA as string,\n\t\tDESCR_RCBL_FATURA as string,\n\t\tDT_PAGAMENTO as timestamp,\n\t\tDEBIT_ID as string,\n\t\tDT_EMISSAO_FATURA_ORIGINAL as timestamp,\n\t\tUF_NF as string,\n\t\tVLR_PGTO_ALOCADO as decimal(15,2),\n\t\tVLR_TOTAL_PGTO as decimal(15,2),\n\t\tCREDIT_ID as string,\n\t\tDT_REFERENCIA as timestamp,\n\t\tDT_IMPORTACAO as timestamp,\n\t\tSTEP_EXECUTION_ID as decimal(18,0),\n\t\tJOB_EXECUTION_ID as decimal(18,0),\n\t\tID_MESTRE_CONVENIO_115 as decimal(28,0),\n\t\tFL_MANUAL_CONCILIACAO as string,\n\t\tDT_CONCILIACAO as timestamp\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tID_CLIENTE,\n\t\tVLR_TOTAL_ATRIBUIDO = VLR_ATRIBUIDO,\n\t\tDT_ATRIBUICAO,\n\t\tDT_AJUSTE,\n\t\tDESC_MOTIVO_AJUSTE,\n\t\tCLASSE_RECEBER,\n\t\tDT_EMISSAO_FATURA_ORIGINAL = DT_EMISSAO_FATURA,\n\t\tSEQ_RECEBIVEL,\n\t\tHR_AJUSTE,\n\t\tHR_ATRIBUICAO,\n\t\tSALDO_DEVEDOR,\n\t\tSALDO_FATURA_INI,\n\t\tSALDO_FATURA_FIM,\n\t\tMES_ANO_FAT_ORIGINAL = MES_ANO_FATURA,\n\t\tNUM_CONTROLE_RECLAMACAO_NORMALIZADO,\n\t\tNOTA_FISCAL_ORIG_NORMALIZADO,\n\t\tNOTA_FISCAL_ORIG = NOTA_FISCAL,\n\t\tDT_EMISSAO_NF_ORIG = DT_EMISSAO_NF,\n\t\tID_LOTE_AJUSTE = ID_LOTE,\n\t\tVLR_ORIG_NSFT = VLR_ORIG_NFST,\n\t\tSERIE_NF = SERIE,\n\t\tCOD_IDENT_CLI = CONTA_CLIENTE,\n\t\tCPF_CNPJ = CNPJ_CPF,\n\t\tNOME_CLIENTE = NOM_CLIENTE,\n\t\tTERMINAL = NUM_TERMINAL,\n\t\tVLR_ATRIBUIDO = VLR_CONTEST_AJUSTE,\n\t\tDESCR_OPERADORA = OPERADORA,\n\t\tCOD_OPERADORA = CODIGO_OPERADORA,\n\t\tNUM_CONTROLE_RECLAMACAO = DSPUT_ID,\n\t\tCONTA_FINANCEIRA = CONTA_CONTABIL,\n\t\tDESC_CONTA_FINANCEIRA = DESCR_CONTA_CONTABIL,\n\t\tNUM_FATURA_ORIGINAL = NUMERO_FATURA,\n\t\tVLR_DOC_ORIGINAL = VALOR_DOCTO_ORIGINAL,\n\t\tMES_ANO_FAT_ORIGINAL = MES_ANO_REFERENTE,\n\t\tVLR_PAGAMENTO_FAT_ORIGINAL = VALOR_PAGAMENTO,\n\t\tFATURA_ATRIBUIDA = FATU_ATRIBUIDA,\n\t\tMES_ANO_FAT_AJUSTE = MES_ANO_FATURA,\n\t\tVLR_FATURA = VALOR_FATURA,\n\t\tUF_FATURA = UF,\n\t\tDT_ABERTURA_IMPUG = DATA_ABERTURA_IMPU,\n\t\tDT_FECHA_IMPUG = DATA_FECH_IMPUG,\n\t\tTIPO_DOCUMENTO = CNPJ_CPF,\n\t\tDT_VENC_FATURA_ORIGINAL = DATA_VENC_FATUR,\n\t\tDT_ATRIBUICAO_PGTO = DATA_ATRIBUICAO_PGTO,\n\t\tCOD_MOTIVO_AJUSTE = COD_MOTIVO_AJUSTES,\n\t\tFL_STATUS_GERAL,\n\t\tCD_CRIADO_POR,\n\t\tNOME_BILLING,\n\t\tDT_CRIADO_EM\n\t)) ~> TabelaCONTESTACAO"
		}
	}
}